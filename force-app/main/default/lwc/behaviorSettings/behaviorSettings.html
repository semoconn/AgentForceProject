<template>
    <lightning-card>
        <div slot="title">
            <div class="slds-media slds-media_center">
                <div class="slds-media__figure">
                    <lightning-icon icon-name="standard:custom_notification" size="medium"></lightning-icon>
                </div>
                <div class="slds-media__body">
                    <h2 class="slds-card__header-title">
                        <span class="slds-text-heading_small">Detection Thresholds</span>
                    </h2>
                    <p class="slds-text-body_small slds-text-color_weak">
                        Configure when records are flagged by the BehaviorIQ detection engine.
                    </p>
                </div>
            </div>
        </div>

        <div class="slds-p-horizontal_medium slds-p-bottom_medium">
            <template if:true={isLoading}>
                <div class="slds-is-relative" style="height: 200px;">
                    <lightning-spinner alternative-text="Loading..." size="medium" variant="brand"></lightning-spinner>
                </div>
            </template>

            <template if:false={isLoading}>
                <!-- Case Thresholds -->
                <div class="slds-section slds-is-open slds-m-bottom_medium">
                    <h3 class="slds-section__title">
                        <span class="slds-truncate slds-p-horizontal_small slds-text-title_caps" title="Case Patterns">
                            <lightning-icon icon-name="utility:case" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                            Case Patterns
                        </span>
                    </h3>
                    <div class="slds-section__content">
                        <div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-theme_shade slds-m-bottom_small setting-box">
                                    <lightning-input
                                        type="number"
                                        name="staleCaseThreshold"
                                        label="Stale Case Threshold (Days)"
                                        value={staleCaseThreshold}
                                        onchange={handleConfigInputChange}
                                        min="1"
                                        max="999"
                                        step="1"
                                        variant="label-stacked">
                                    </lightning-input>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                        Cases with no activity for this many days are flagged. <strong>Default: 30 days</strong>
                                    </p>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_xx-small">
                                        <lightning-icon icon-name="utility:connected_apps" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                        Affects: Stale Cases pattern
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Opportunity Thresholds -->
                <div class="slds-section slds-is-open slds-m-bottom_medium">
                    <h3 class="slds-section__title">
                        <span class="slds-truncate slds-p-horizontal_small slds-text-title_caps" title="Opportunity Patterns">
                            <lightning-icon icon-name="utility:opportunity" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                            Opportunity Patterns
                        </span>
                    </h3>
                    <div class="slds-section__content">
                        <div class="slds-grid slds-gutters slds-wrap">
                            <!-- Stale Opportunity -->
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-theme_shade slds-m-bottom_small setting-box">
                                    <lightning-input
                                        type="number"
                                        name="staleOpportunityThreshold"
                                        label="Stale Opportunity Threshold (Days)"
                                        value={staleOpportunityThreshold}
                                        onchange={handleConfigInputChange}
                                        min="1"
                                        max="999"
                                        step="1"
                                        variant="label-stacked">
                                    </lightning-input>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                        Opportunities with no stage change for this many days. <strong>Default: 90 days</strong>
                                    </p>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_xx-small">
                                        <lightning-icon icon-name="utility:connected_apps" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                        Affects: Stale Opportunity pattern
                                    </p>
                                </div>
                            </div>

                            <!-- High-Value Inactivity -->
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-theme_shade slds-m-bottom_small setting-box">
                                    <lightning-input
                                        type="number"
                                        name="highValueInactivityDays"
                                        label="High-Value Inactivity (Days)"
                                        value={highValueInactivityDays}
                                        onchange={handleConfigInputChange}
                                        min="1"
                                        max="999"
                                        step="1"
                                        variant="label-stacked">
                                    </lightning-input>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                        High-value opportunities with no activity for this many days. <strong>Default: 14 days</strong>
                                    </p>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_xx-small">
                                        <lightning-icon icon-name="utility:connected_apps" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                        Affects: High-Value Ghosting pattern
                                    </p>
                                </div>
                            </div>

                            <!-- High-Value Amount -->
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-theme_shade slds-m-bottom_small setting-box">
                                    <lightning-input
                                        type="number"
                                        name="highValueAmountThreshold"
                                        label="High-Value Amount Threshold ($)"
                                        value={highValueAmountThreshold}
                                        onchange={handleConfigInputChange}
                                        min="1"
                                        step="1"
                                        formatter="currency"
                                        variant="label-stacked">
                                    </lightning-input>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                        Opportunities above this amount are considered "high-value". <strong>Default: $50,000</strong>
                                    </p>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_xx-small">
                                        <lightning-icon icon-name="utility:connected_apps" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                        Affects: High-Value Ghosting pattern
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lead Thresholds -->
                <div class="slds-section slds-is-open slds-m-bottom_medium">
                    <h3 class="slds-section__title">
                        <span class="slds-truncate slds-p-horizontal_small slds-text-title_caps" title="Lead Patterns">
                            <lightning-icon icon-name="utility:lead" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                            Lead Patterns
                        </span>
                    </h3>
                    <div class="slds-section__content">
                        <div class="slds-grid slds-gutters slds-wrap">
                            <!-- Unassigned Lead Hours -->
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-theme_shade slds-m-bottom_small setting-box">
                                    <lightning-input
                                        type="number"
                                        name="unassignedLeadHours"
                                        label="Unassigned Lead Threshold (Hours)"
                                        value={unassignedLeadHours}
                                        onchange={handleConfigInputChange}
                                        min="1"
                                        max="720"
                                        step="1"
                                        variant="label-stacked">
                                    </lightning-input>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                        Leads sitting in queue for this many hours are flagged. <strong>Default: 48 hours</strong>
                                    </p>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_xx-small">
                                        <lightning-icon icon-name="utility:connected_apps" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                        Affects: Unassigned Lead pattern
                                    </p>
                                </div>
                            </div>

                            <!-- Lead Hoarding Days -->
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-theme_shade slds-m-bottom_small setting-box">
                                    <lightning-input
                                        type="number"
                                        name="leadHoardingDays"
                                        label="Lead Hoarding Threshold (Days)"
                                        value={leadHoardingDays}
                                        onchange={handleConfigInputChange}
                                        min="1"
                                        max="999"
                                        step="1"
                                        variant="label-stacked">
                                    </lightning-input>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                        Leads owned but not contacted for this many days. <strong>Default: 5 days</strong>
                                    </p>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_xx-small">
                                        <lightning-icon icon-name="utility:connected_apps" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                        Affects: Lead Hoarding pattern
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contract Thresholds -->
                <div class="slds-section slds-is-open slds-m-bottom_medium">
                    <h3 class="slds-section__title">
                        <span class="slds-truncate slds-p-horizontal_small slds-text-title_caps" title="Contract Patterns">
                            <lightning-icon icon-name="utility:contract" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                            Contract Patterns
                        </span>
                    </h3>
                    <div class="slds-section__content">
                        <div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-theme_shade slds-m-bottom_small setting-box">
                                    <lightning-input
                                        type="number"
                                        name="contractExpiryDays"
                                        label="Contract Expiry Alert (Days)"
                                        value={contractExpiryDays}
                                        onchange={handleConfigInputChange}
                                        min="1"
                                        max="999"
                                        step="1"
                                        variant="label-stacked">
                                    </lightning-input>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                        Contracts expiring within this many days are flagged. <strong>Default: 30 days</strong>
                                    </p>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_xx-small">
                                        <lightning-icon icon-name="utility:connected_apps" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                        Affects: Contract Expiry Red Zone pattern
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Retention -->
                <div class="slds-section slds-is-open slds-m-bottom_medium">
                    <h3 class="slds-section__title">
                        <span class="slds-truncate slds-p-horizontal_small slds-text-title_caps" title="Data Retention">
                            <lightning-icon icon-name="utility:clock" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                            Data Retention
                        </span>
                    </h3>
                    <div class="slds-section__content">
                        <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">
                            Configure how long BehaviorIQ keeps historical data. Older records are automatically deleted during scheduled batch runs.
                        </p>
                        <div class="slds-grid slds-gutters slds-wrap">
                            <!-- Raw Log Retention -->
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-theme_shade slds-m-bottom_small setting-box">
                                    <lightning-input
                                        type="number"
                                        name="rawLogRetentionDays"
                                        label="Raw Log Retention (Days)"
                                        value={rawLogRetentionDays}
                                        onchange={handleConfigInputChange}
                                        min="7"
                                        max="90"
                                        step="1"
                                        variant="label-stacked">
                                    </lightning-input>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                        Individual event logs. <strong>Default: 14 days</strong> (7-90)
                                    </p>
                                </div>
                            </div>

                            <!-- Summary Retention -->
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-theme_shade slds-m-bottom_small setting-box">
                                    <lightning-input
                                        type="number"
                                        name="summaryRetentionDays"
                                        label="Summary Retention (Days)"
                                        value={summaryRetentionDays}
                                        onchange={handleConfigInputChange}
                                        min="30"
                                        max="730"
                                        step="1"
                                        variant="label-stacked">
                                    </lightning-input>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                        Daily aggregate counters for leaderboard and trends. <strong>Default: 365 days</strong> (30-730)
                                    </p>
                                </div>
                            </div>

                            <!-- Snapshot Retention -->
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-theme_shade slds-m-bottom_small setting-box">
                                    <lightning-input
                                        type="number"
                                        name="snapshotRetentionDays"
                                        label="Snapshot Retention (Days)"
                                        value={snapshotRetentionDays}
                                        onchange={handleConfigInputChange}
                                        min="30"
                                        max="365"
                                        step="1"
                                        variant="label-stacked">
                                    </lightning-input>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                        Trend chart snapshot data. <strong>Default: 90 days</strong> (30-365)
                                    </p>
                                </div>
                            </div>

                            <!-- Health Log Retention -->
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-theme_shade slds-m-bottom_small setting-box">
                                    <lightning-input
                                        type="number"
                                        name="healthLogRetentionDays"
                                        label="Health Log Retention (Days)"
                                        value={healthLogRetentionDays}
                                        onchange={handleConfigInputChange}
                                        min="30"
                                        max="365"
                                        step="1"
                                        variant="label-stacked">
                                    </lightning-input>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                        Batch job diagnostic logs. <strong>Default: 90 days</strong> (30-365)
                                    </p>
                                </div>
                            </div>

                            <!-- Remediation Log Retention -->
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="slds-box slds-box_x-small slds-theme_shade slds-m-bottom_small setting-box">
                                    <lightning-input
                                        type="number"
                                        name="remediationRetentionDays"
                                        label="Remediation Log Retention (Days)"
                                        value={remediationRetentionDays}
                                        onchange={handleConfigInputChange}
                                        min="90"
                                        max="730"
                                        step="1"
                                        variant="label-stacked">
                                    </lightning-input>
                                    <p class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
                                        Auto-fix audit trail. Keep longer for compliance. <strong>Default: 365 days</strong> (90-730)
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="slds-grid slds-grid_align-spread slds-m-top_medium slds-p-top_small slds-border_top">
                    <lightning-button
                        label="Reset All Defaults"
                        title="Reset all thresholds to factory defaults"
                        icon-name="utility:undo"
                        onclick={handleResetConfig}>
                    </lightning-button>

                    <lightning-button
                        variant="brand"
                        label="Save Thresholds"
                        icon-name="utility:save"
                        onclick={handleSaveConfig}>
                    </lightning-button>
                </div>
            </template>
        </div>
    </lightning-card>
</template>
