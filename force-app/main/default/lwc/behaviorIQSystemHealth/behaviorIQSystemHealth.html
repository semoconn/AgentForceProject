<!--
  @description       : Displays the status of the last BehaviorIQ analysis job run.
  @author            : BehaviorIQ
  @group             : BehaviorIQ
-->
<template>
    <div class="slds-box slds-box_x-small slds-theme_shade slds-m-top_medium slds-m-bottom_medium">
        <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
            <div class="slds-col">
                <h3 class="slds-text-heading_small">
                    <lightning-icon icon-name="utility:pulse" size="small" class="slds-m-right_small"></lightning-icon>
                    System Status
                </h3>
            </div>
            <div class="slds-col slds-text-align_right slds-grid slds-grid_vertical-align-center">
                <!-- Loading state -->
                <template lwc:if={isLoading}>
                    <lightning-spinner alternative-text="Loading" size="small"></lightning-spinner>
                </template>

                <!-- Has health data -->
                <template lwc:if={hasHealthData}>
                    <span class="slds-m-right_small slds-text-color_weak">
                        {sourceLabel}:
                    </span>
                    <span class="slds-m-right_medium">
                        <lightning-formatted-date-time
                            value={health.lastRunTime}
                            year="numeric"
                            month="short"
                            day="2-digit"
                            hour="2-digit"
                            minute="2-digit">
                        </lightning-formatted-date-time>
                    </span>
                    <template lwc:if={isSuccess}>
                        <lightning-badge label="Success" class="success-badge"></lightning-badge>
                    </template>
                    <template lwc:elseif={health.status}>
                        <lightning-badge label={health.status} class="warning-badge"></lightning-badge>
                    </template>
                </template>

                <!-- No health data -->
                <template lwc:if={showNoDataMessage}>
                    <template lwc:if={hasError}>
                        <lightning-badge label="Error loading status" class="error-badge"></lightning-badge>
                    </template>
                    <template lwc:if={noError}>
                        <lightning-badge label="No analysis has run yet"></lightning-badge>
                    </template>
                </template>

                <!-- Run Analysis Now button -->
                <lightning-button
                    variant="brand"
                    label={runButtonLabel}
                    icon-name="utility:refresh"
                    onclick={handleRunAnalysis}
                    disabled={isRunning}
                    class="slds-m-left_medium">
                </lightning-button>
            </div>
        </div>
    </div>
</template>
